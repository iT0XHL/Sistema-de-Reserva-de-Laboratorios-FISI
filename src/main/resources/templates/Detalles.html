<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de solicitud</title>
    <link rel="stylesheet" th:href="@{/Detalles/Detalles.css}">
</head>

<body>

<!-- Sidebar -->
<div th:replace="fragments/sidebarUsuario :: sidebar-usuario"></div>

<div class="top-bar">
    <div class="top-bar-right">
        <div class="user-dropdown">
            <button class="user-info-button" id="userToggle">
                <div class="user-avatar"
                     th:text="${nombre != null and !#strings.isEmpty(nombre) ? #strings.toUpperCase(#strings.substring(nombre, 0, 1)) : 'U'}">
                    U
                </div>
                <span class="user-name" th:text="${nombre}">Usuario</span>
            </button>

            <div class="dropdown-menu" id="userMenu">
                <button class="dropdown-item" th:data-link="@{/perfil}">Mi Perfil</button>
                <button class="dropdown-item" id="logoutBtn">Salir</button>
            </div>
        </div>
    </div>
</div>

<div class="main-content">

    <div class="breadcrumb">
        <a th:href="@{/principalUsuario}">Página Principal</a> >>
        <a th:href="@{/solicitudes}">Mis solicitudes</a> >>
        <span>Detalle de solicitud</span>
    </div>

    <h1 class="welcome-title">Detalles de solicitud</h1>

    <div class="solicitud-card">

        <!-- Estado -->
        <div class="status-row">
            <span class="status-label">Estado:</span>
            <div class="status-badge"
                 th:classappend="${solicitud.estado == 'PENDIENTE'} ? ' pending' : ' completed'">
                <span th:text="${solicitud.estado}">Pendiente</span>
            </div>
        </div>

        <h3>Detalles:</h3>

        <div class="solicitud-details">

            <!-- Tipo de solicitud -->
            <div class="detail-item">
                <!-- Icono para ASIGNACIÓN -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                     th:if="${solicitud.tipo == 'ASIGNACION'}" class="size-6 icon">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M9 12h6m-3-3v6m-6 7.5h12A2.25 2.25 0 0020.25 20V7.5
                             L15 2.25H6A2.25 2.25 0 003.75 4.5v15A2.25 2.25 0 006 21z" />
                </svg>

                <!-- Icono para REASIGNACIÓN -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                     th:if="${solicitud.tipo == 'REASIGNACION'}" class="size-6 icon">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M4.5 4.5v6h6M19.5 19.5v-6h-6M5.25 19.5A8.25 8.25 0 0 0 18 9.75h1.5M6 14.25A8.25 8.25 0 0 1 18.75 4.5H17.25" />
                </svg>

                Tipo de solicitud:
                <span id="tipoSolicitudText"
                      th:text="${solicitud.tipo == 'REASIGNACION' ? 'Reasignación' : 'Asignación'}">
                    Asignación
                </span>
            </div>

            <!-- Laboratorio -->
            <div class="detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25" />
                </svg>
                Lab:
                <span th:text="${solicitud.laboratorio != null ? solicitud.laboratorio.idLaboratorio : 'Por asignar'}"></span>
            </div>

            <!-- Fecha -->
            <div class="detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor" class="size-6 icon">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Fecha:
                <span th:text="${#temporals.format(
                    solicitud.fechaReserva.toInstant().atZone(T(java.time.ZoneId).of('America/Lima')).toLocalDate(),
                    'd MMM yyyy')}">
                </span>
            </div>

            <!-- Horas -->
            <div class="detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                     stroke-width="1.5" stroke="currentColor" class="size-6 icon">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Hora:
                <span th:text="${#temporals.format(solicitud.horaInicio.toLocalTime(), 'HH:mm')}"></span>
                –
                <span th:text="${#temporals.format(solicitud.horaFin.toLocalTime(), 'HH:mm')}"></span>
            </div>

            <!-- Requerimientos -->
            <div class="detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                     stroke-width="1.5" stroke="currentColor" class="size-6 icon">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M9 12h6m-6 4h6M7 4h10a2 2 0 012 2v12a2 2 0 01-2 2H7a2 2 0 01-2-2V6a2 2 0 012-2z" />
                </svg>
                Requerimientos:
                <span id="reqText"
                      th:text="${solicitud.requerimientos != null ? solicitud.requerimientos : 'Sin requerimientos'}">
                    Sin requerimientos
                </span>
            </div>

        </div>

        <!-- Botones -->
        <div class="action-row">
            <a href="javascript:history.back()" class="btn-back">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                     stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                </svg>
                Regresar
            </a>

            <a class="btn-reassign"
               th:href="@{/solicitudes/reasignar(
                            id=${solicitud.idSolicitud},
                            fecha=${#dates.format(solicitud.fechaSolicitud,'yyyy-MM-dd HH:mm:ss.S')}
                        )}">
                Reasignar
            </a>
        </div>
    </div>
</div>

<script th:src="@{/Detalles/Detalles.js}"></script>
</body>
</html>
