<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página Principal</title>
    <link rel="stylesheet" th:href="@{/PrincipalUsuario/PrincipalUsuariostyle.css}">
</head>

<body>

<!-- Sidebar reutilizable -->
<div th:replace="fragments/sidebarUsuario :: sidebar-usuario"></div>

<div class="top-bar">
    <div class="top-bar-right">
        <div class="user-dropdown">
            <button class="user-info-button" id="userToggle">
                <div class="user-avatar"
                     th:text="${nombre != null and !#strings.isEmpty(nombre) ? #strings.toUpperCase(#strings.substring(nombre, 0, 1)) : 'U'}">
                    U
                </div>
                <span class="user-name" th:text="${nombre}">Usuario</span>
            </button>

            <div class="dropdown-menu" id="userMenu">
                <button class="dropdown-item" th:data-link="@{/perfil}">
                    Mi Perfil
                </button>

                <button class="dropdown-item" id="logoutBtn">
                    Salir
                </button>
            </div>
        </div>
    </div>
</div>

<div class="main-content">
    <h1 class="welcome-title">Bienvenido, <span th:text="${nombre}">Usuario</span>!</h1>

    <div class="content-section">
        <div class="section-title">Solicitudes actuales:</div>

        <div class="reservations-container">

            <!-- ========= SOLICITUDES DINÁMICAS ========= -->
            <div class="reservation-card"
                 th:each="solicitud, i : ${solicitudes}">

                <div class="reservation-status">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="m4.5 12.75 6 6 9-13.5" />
                    </svg>
                    <span th:text="${solicitud.estado}">Aceptada</span>
                </div>

                <!-- TÍTULO: Solicitud + ID -->
                <div class="reservation-title">
                    Solicitud <span th:text="${solicitud.idSolicitud}">ID-001</span>
                </div>

                <div class="reservation-details">
                    <div class="detail-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                             stroke-width="1.5" stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 
                                     15 18.257V17.25m6-12V15a2.25 2.25 
                                     0 0 1-2.25 2.25H5.25A2.25 2.25 
                                     0 0 1 3 15V5.25" />
                        </svg>
                        <!-- Si no hay lab → "No asignado" -->
                        <span th:text="${solicitud.idLaboratorio != null and !#strings.isEmpty(solicitud.idLaboratorio) ? solicitud.idLaboratorio : 'No asignado'}">
                            No asignado
                        </span>
                    </div>

                    <div class="detail-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 
                                     0 002-2V7a2 2 0 00-2-2H5a2 2 
                                     0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span th:text="${#dates.format(solicitud.fechaReserva,'dd/MM/yyyy')}">
                            Fecha
                        </span>
                    </div>

                    <div class="detail-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                             viewBox="0 0 24 24" stroke-width="1.5"
                             stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M12 6v6h4.5m4.5 0a9 9 
                                     0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                        <span th:text="${#dates.format(solicitud.horaInicio,'HH:mm')}"></span>
                        -
                        <span th:text="${#dates.format(solicitud.horaFin,'HH:mm')}"></span>
                    </div>
                </div>

                <button class="btn-details"
                        th:data-id="${solicitud.idSolicitud}"
                        th:data-fecha="${#dates.format(solicitud.fechaSolicitud, 'yyyy-MM-dd''T''HH:mm:ssXXX')}">
                    Más detalles
                </button>

            </div>
            <!-- ============================================================= -->

        </div>

        <div class="section-title">Accesos directos:</div>

        <div class="direct-access-container">

            <!-- BOTÓN RESERVAR -->
            <div class="access-button" th:data-link="@{/reserva}">
                <svg width="40px" height="40px" stroke-width="" viewBox="0 0 24 24" fill="none"
                     xmlns="http://www.w3.org/2000/svg" color="#D9D9D9">
                    <path d="M2 21L17 21" stroke="#D9D9D9" stroke-width="2" stroke-linecap="round"
                          stroke-linejoin="round"></path>
                    <path d="M21 21L22 21" stroke="#D9D9D9" stroke-width="2" stroke-linecap="round"
                          stroke-linejoin="round"></path>
                    <path d="M2 16.4V3.6C2 3.26863 2.26863 3 2.6 3H21.4C21.7314 3 22 3.26863 22 3.6V16.4C22
                            16.7314 21.7314 17 21.4 17H2.6C2.26863 17 2 16.7314 2 16.4Z"
                          stroke="#D9D9D9" stroke-width="2"></path>
                </svg>
                <div class="access-label">Reservar</div>
            </div>

            <!-- BOTÓN RESERVAS -->
            <div class="access-button" th:data-link="@{/reservas}">
                <svg width="40px" height="40px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#D9D9D9" stroke-width="1.5">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 
                    22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM12.75 6C12.75 5.58579 12.4142 5.25 12 5.25C11.5858 5.25 11.25 5.58579 11.25 6L11.25 12C11.25 12.4142 11.5858 
                    12.75 12 12.75H18C18.4142 12.75 18.75 12.4142 18.75 12C18.75 11.5858 18.4142 11.25 18 11.25H12.75L12.75 6Z" fill="#D9D9D9"></path>
                </svg>
                <div class="access-label">Reservas</div>
            </div>

            <!-- BOTÓN SOLICITUDES -->
            <div class="access-button" th:data-link="@{/solicitudes}">
                <svg xmlns="http://www.w3.org/2000/svg" width="40px" height="40px" fill="none"
                     viewBox="0 0 24 24" stroke="#D9D9D9">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 12h6m-6 4h6m2 5H7a2 2 
                            0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 
                            01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 
                            2 0 01-2 2z" />
                </svg>
                <div class="access-label">Solicitudes</div>
            </div>

        </div>

    </div>
</div>

<div class="transition-container" id="pageTransition">
    <div class="transition-bar"></div>
    <div class="transition-bar"></div>
    <div class="transition-bar"></div>
</div>

<script th:src="@{/PrincipalUsuario/PrincipalUsuarioscripts.js}"></script>
</body>
</html>
